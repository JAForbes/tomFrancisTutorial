sounds = {
	Reforming : [
		["synth",0.0000,1.0000,0.0950,0.6220,1.7520,1.0920,1119.0000,746.0000,428.0000,0.0720,-0.0620,0.4130,8.1203,-0.2701,0.2920,0.9860,0.4240,0.0585,-0.7420,0.2112,0.3900,-0.5940,0.0850,0.8560,0.5500,0.9370,0.4960]
	],
	Restore: [
		["sine",0.0000,1.0000,0.8380,0.0300,0.4380,0.6700,1957.0000,562.0000,1220.0000,0.4920,0.9640,0.0920,8.2643,-0.2298,-0.9880,-0.4860,0.0330,0.2745,0.7560,0.7584,-0.0560,-0.8100,0.3290,0.5600,0.6430,0.2780,-0.2140]
	],
	Splat:  [
		["noise",10.0000,0.07,0.0000,1.2680,0.5280,1.3660,546.0000,221.0000,2166.0000,-1.0000,-1.0000,0.2690,21.8934,0.2772,-0.0280,-0.7540,0.8800,0.4235,0.6480,0.3608,-0.1020,-0.1060,0.5740,0.3900,0.6340,0.2780,-0.0880]
	],
	Shoot: [
		//These should all be mutated sounds later
		["noise",0.0000,0.2000,0.0110,1.3740,1.4400,0.0280,1067.0000,2034.0000,1153.0000,-0.6000,-0.5940,0.1450,38.8819,0.4137,0.1980,0.2020,0.2840,0.0870,0.0020,0.2624,-0.6940,-0.3000,0.3290,-0.7060,0.5310,0.3300,-0.4480],
		["noise",0.0000,0.2000,0.0110,1.3740,1.4400,0.0280,1067.0000,2034.0000,1153.0000,-0.6000,-0.5940,0.1450,38.8819,0.4137,0.1980,0.2020,0.2840,0.0870,0.0020,0.2624,-0.6940,-0.3000,0.3290,-0.7060,0.5310,0.3300,-0.4480],
		["noise",0.0000,0.2000,0.0110,1.3740,1.4400,0.0280,1067.0000,2034.0000,1153.0000,-0.6000,-0.5940,0.1450,38.8819,0.4137,0.1980,0.2020,0.2840,0.0870,0.0020,0.2624,-0.6940,-0.3000,0.3290,-0.7060,0.5310,0.3300,-0.4480]
	],
	Laser: [
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000],
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000],
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000],
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000],
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000],
		["sine",9.0000,0.2000,0.0000,0.1820,0.0660,0.1940,20.0000,1201.0000,2400.0000,-0.6820,0.0000,0.0000,0.0100,0.0003,0.0000,0.0000,0.0000,0.0780,0.1240,0.0000,0.0000,0.0000,1.0000,0.0000,0.0000,0.0000,0.0000]
	],
	CloudGun: [
		["noise",0.0000,0.4000,0.5470,0.2340,0.3510,1.1480,476.0000,412.0000,1099.0000,0.1840,0.5020,0.0960,35.2347,0.1927,0.0220,-0.1800,0.4850,0.2365,-0.6440,0.6672,0.3740,-0.0520,0.9680,-0.0780,0.9960,0.9940,0.0060],
		["noise",0.0000,0.4000,0.5470,0.2340,0.3510,1.1480,476.0000,412.0000,1099.0000,0.1840,0.5020,0.0960,35.2347,0.1927,0.0220,-0.1800,0.4850,0.2365,-0.6440,0.6672,0.3740,-0.0520,0.9680,-0.0780,0.9960,0.9940,0.0060],
		["noise",0.0000,0.4000,0.5470,0.2340,0.3510,1.1480,476.0000,412.0000,1099.0000,0.1840,0.5020,0.0960,35.2347,0.1927,0.0220,-0.1800,0.4850,0.2365,-0.6440,0.6672,0.3740,-0.0520,0.9680,-0.0780,0.9960,0.9940,0.0060]
	],
	Shrink: [
		["saw",1.0000,1.0000,0.2790,1.2060,0.9330,0.6520,766.0000,254.0000,756.0000,-0.6960,0.4760,0.8990,47.1842,0.7322,0.9640,-0.6320,0.1470,0.4095,-0.5640,0.6040,-0.9600,-0.1740,0.9710,0.4420,0.0470,0.6300,-0.9020]
	]
}
//initial sounds
_.each(sounds, function(samples, name){
	samples.forEach(function(sample,i){
		sounds[name][i] = jsfxlib.createWave(sample)
	})
})

game = C({
	Screen: { width: 1, height: 1, el: document.querySelector('canvas'), con: document.querySelector('canvas').getContext('2d'), translate: [0.5, 0.5] },
	Camera: { tracking: 3 , last_position: {x:0, y:0 }},
	Save: { state: {} },
	QuickSave: {},
	Has: {
		'Key_Q': { QuickSave: { component: {} , every: Infinity }},
		'Key_R': { QuickLoad: { component: {} , every: Infinity }}
	},
	InfiniteBackground: { image: s_background },
	DrawOrder: {
		groups: [
			'Weapon', 'Enemy', 'Particle', 'Player', 'Pickup'
		]
	}

})



room01 = function(){

	mouse = C({
		Location: { x:0, y:0 },
		Translate: { x: -0.5, y: -0.5 },
		Mouse: { game: game },
	})

	Player = {
		Alpha: { value: 1 },
		BounceBox: { x:-1200, y:-1200, width: 2400, height: 2400 },
		Angle: { value: 0 },
		Facing: { entity: mouse },
		Location: {x:10,y:14},
		Velocity: {x:0,y:0},
		Acceleration: { x:0 , y:0 },
		Friction: { value: 0.9 },
		Dimensions: { width: 32, height: 32},
		Sprite: { image: s_player },
		KickBack: {ratio: 0.5},
		Sounds: {
			Splat: { sounds: sounds.Splat }
		},
		Has: {
			'RightClick' : {
				CycleWeapons: { component: {}, every: Infinity },
			},
			'Key_A|Key_LEFT': {
				Accelerate: { component: {x: -1} },
			},
			'Key_D|Key_RIGHT': {
				Accelerate: { component: {x: 1} }
			},
			'Key_S|Key_DOWN': {
				Accelerate: { component: {y: 1} }
			},
			'Key_W|Key_UP': {
				Accelerate: { component: {y: -1} }
			},
			'@Collided': {
				Velocity: { component: { x:0, y:0 }},
				Acceleration: { component: { x:0, y:0 }},
				Accelerate: { component: {x:0, y:0 }},

			}
		},
		CollidesWith: {
			Splatter: {
				Splat: { wave: { Reform: {} }, components: { Particle: {}, Sprite: { image: s_splat } } }
			},
			Pickup: {
				//Mix  collided Pickup components with yourself
				MixinPickup: {}
			},
			Remover: {
				Backup: {  omit: ['Splat','Remove','Collided']},
				Remove: {  omit: ['Backup','Splat'] }
			}
		},
		Pickuper: {},
		SAT: {},
		Player: {}
	}
	Enemy = {
		Enemy: {},
		Angle: { value: 0},
		Facing: { entity: mouse},
		Location: { x: -200, y: 200},
		Velocity: { x:0, y:0 },
		Acceleration: { x:0 , y:0 },
		Speed: {value: 5},
		Dimensions: { width: 64, height: 64 },
		Sprite: { image: s_enemy },
		SAT: {},
		CollidesWith: {
			Shrinker: {
				Shrink: {min_size: 32, ratio: 0.9 }
			},
			Pusher: {
				Pushed: {}
			}
		},
		Friction: { value: 0.01 },
		Repeat: {
			Patrol: {
				component: {
					waypoints: [
						{x:-200, y: -200},
						{x: 200 , y: -200 },
						{x: 200 , y: -200 },
						{x: 200 , y: 200 },
					]
				},
				remaining: Infinity
			}
		},
		Sounds: {
			Splat: { sounds: sounds.Splat },
			Shrink: {sounds: sounds.Shrink }
		},
		Remover: {},
		Splatter: {},
	}


	Exploding_Enemy = {
		Enemy: {},
		Angle: { value: 0},
		Velocity: { x:0, y:0 },
		Randomise: {
			Location: {
				x: [-250, 250],
				y: [-250, 250]
			},
			Angle: { value: [0, 2*Math.PI] }
		},
		Friction: { value: 0.7 },
		AccelerationRate: { value: 1},
		Repeat: {
			Accelerate: { component: {} , remaining: Infinity}
		},
		Dimensions: { width: 64, height: 64 },
		Sprite: { image: s_exploding_enemy },
		BounceBox: { x:-300, y:-300, width: 600, height: 600 },
		SAT: {},
		CollidesWith: {
			Splatter: {
				Splat: {
					components: {
						Particle: {},
						Sprite: { image: s_exploding_enemy_splat },
						Repeat: {
							Shrink: {
								component: { min_size: 4, ratio: 0.96 },
								remaining: Infinity
							}
						},
					},
					velocity_range: [10,20]
				},
				Remove: { component: {  omit: ['Splat'] } }
			},
			Pusher: {
				Pushed: {}
			}
		},
		Has: {},
		Sounds: {
			Splat: { sounds: sounds.Splat }
		},
		Remover: {},
		Splatter: {}
	}

	cameraBot = C({
		Location: { x:10, y:14 },
		Velocity: { x:0, y: 0},
		Dimensions: { width: 32, height: 32},
		Angle: { value: 0},
		//Sprite: { image: s_bullet },
		Acceleration: { x:0 , y:0 },
		//Stability of camera: Screenshake
		Friction: { value: 0.9 },
		//Don't see past the boundary
		PanBoundary: { x:-1200, y:-1200, width: 2400, height: 2400 },
		Has:  {
			'Collided': {
				//Screen Shake
				Velocity: { component: {x:10, y: 10} },
			}
		}
	})

	LaserGun = {
		Sounds: {
			Shoot: { sounds: sounds.Laser }
		},
		Has: {
			'Click|Key_SPACE' : {
				Shoot:{
					component : {
						jitter: 0,
						size: 30,
						size_variation: 5,
						spread: 0,
						speed_range: [20,20],
						image: s_laser,
						components: {
							Particle: {},
							GarbageCollected: {},
							SAT: {},
							CollidesWith: {
								Remover: {
									Remove: {}
								}
							},
							Shrinker: {},
							Splatter: {},
							Damage: { value: 2 },
						}
					},
					every: 4
				}
			}
		}
	}

	CloudGun = {
		Has: {
			'Click|Key_SPACE': {
				Shoot: {
					component : {
						jitter: 0,
						size: 16,
						size_variation: 10,
						spread: Math.PI/8,
						speed_range: [2,5],
						image: s_waveGun,
						components: {
							Particle: {},
							GarbageCollected: {},
							SAT: {},
							Friction: { value: 0.95},
							CollidesWith: {
								// Igniter: {
								// 	Ignite: {}
								// }
							},
							Alpha: { value: 0.95},
							Repeat: {
								Grow: {
									component: { max_size: 1000, ratio: 1.005 },
									remaining: Infinity
								},
								Fade: {
									component: { ratio: 0.993 },
									remaining: Infinity
								}
							},
							Has: {
								'@FadeComplete': {
									Remove: { component: {} }
								}
							},
							Pusher: {},
							// Ignitable: {},
							Damage: { value: 1}
						}
					},
					every: 3
				},
			}
		},
		Sounds: {
			Shoot: { sounds: sounds.CloudGun }
		},
	}

	CloudGunPickup = {
		Location: { x: 200, y: 100},
		Velocity: { x:0, y:0 },
		Acceleration: { x: 0, y: 0},
		Friction: { value: 1 },
		Sprite: { image: s_waveGun },
		Angle: { value: 0 },
		Dimensions: { height: 32, width: 32},
		//todo have Pickups bob up and down, or rotate
		//with a PickupAnimate system
		Pickup: {
			Create: {
				components: _.extend({
					Weapon: {},
					Dimensions: { width: 32, height: 32 },
					Sprite: { image: s_waveGun },
					OwnerOffset: { x:15 , y:-8, angle: 0 },
					// If there is already a CloudGun owned by this entity
					// Merge into the current id for that CloudGun
					InventoryItem: { type: 'CloudGun', replace: true }
				}, CloudGun)
			}
		},
		SAT: {},
		CollidesWith: {
			Pickuper: {
				Remove: {}
			}
		},
	}

	LaserPickup = {
		Location: { x: -200, y: -100},
		Velocity: { x:0, y:0 },
		Acceleration: { x: 0, y: 0},
		Friction: { value: 1 },
		Sprite: { image: s_laser_rifle_pickup },
		Angle: { value: 0 },
		Dimensions: { height: 64, width: 64},
		//todo have Pickups bob up and down, or rotate
		//with a PickupAnimate system
		Pickup: {
			Create: {
				components: _.extend({
					Weapon: {},
					Dimensions: { width: 64, height: 64 },
					Sprite: { image: s_laser_rifle_pickup },
					OwnerOffset: { x:15, y:-5 , angle: 0 },
					InventoryItem: { type: 'Laser', replace: true }
				}, LaserGun)
			}
		},
		SAT: {},
		CollidesWith: {
			Pickuper: {
				Remove: {}
			}
		}
	}

	C(_.cloneDeep(CloudGunPickup))
	C(_.cloneDeep(LaserPickup))
	var pickup3 = C(_.cloneDeep(LaserPickup))
	C('Location',{ x: 400, y: 200}, pickup3)

	player = C(_.cloneDeep(Player))


	C('Tether',{ entity: player , elasticity: 0.5 },cameraBot)
	C('Camera',game).tracking = cameraBot
	 enemy = C(_.cloneDeep(Enemy))
	// exploding_enemy = C(_.cloneDeep(Exploding_Enemy))
	// //todo may need to clone deep
	// exploding_enemy2 = C(_.cloneDeep(Exploding_Enemy))


	C({
		Location: { x:0, y:0 },
		Every: {
			//loops
			300: {
				Choose: {
					enemy: { Create: { components: Enemy } } ,
					exploding_enemy: { Create: {components: Exploding_Enemy }}
				}
			}
		}
	},game)



	use = [
		'Screen',
		'InfiniteBackground',
		'Camera',
		'Mouse',
		'Translate',
		'CollidesWith',
		'SAT_sync',
		'SAT',
		'CategoryAge',
		'ComponentAge',
		'CycleWeapons',
		'Every',
		'Choose',
		'Inventory',
		'Create',
		'Randomise',
		'Owner',
		'OwnerOffset',
		'Patrol',
		'Waypoint',
		'Has',
		'CycleWeapons',
		'Shoot',
		'KickBack',
		'Accelerate',
		'VelocitySyncedWithAngle',
		'BounceBox',
		'Facing',
		'Tether',
		'PanBoundary',
		'Friction',
		'Move',
		'Stopped',
		'OrderedDraw',
		'GarbageCollection',
		'Vulnerable',
		'Pickup',
		'Shrink',
		'Fade',
		'Grow',
		'Reform',
		'Pushed',
		'Splat',
		'Spawn',
		'Sounds',
		'Backup',
		'DeleteEntity',
		'RemoveEntity',
		'RemoveComponent',
		'QuickSave',
		'QuickLoad',
		'RemoveCategory',
		'Repeat',
		'Restore',

	]

}

room01()

loop = function(){
	use.map(function(system){
		systems[system]()
	})
	requestAnimationFrame(loop)
}

loop()
